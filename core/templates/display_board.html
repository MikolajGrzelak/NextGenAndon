{% extends "base.html" %}
{% block content %}

<div class="container mt-5">
    <h2 class="mb-4">
        {% if category == 'technician' %}
            🔧 Tablica Zgłoszeń Techników
        {% elif category == 'quality' %}
            🏅 Tablica Zgłoszeń Jakości
        {% else %}
            🛠️ Tablica Zgłoszeń Inżynierów
        {% endif %}
    </h2>

    {% if tickets %}
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Zgłaszający</th>
                    <th>Miejsce pracy</th>
                    <th>Opis</th>
                    <th>Kategoria</th>
                    <th>Status</th>
                    <th>Akcje</th>
                </tr>
                <style>
                    /* Miganie dla otwartych zgłoszeń */
                    .blinking {
                    animation: blink 1s infinite alternate;
                    }
                
                    @keyframes blink {
                        0% { background-color:rgb(48, 8, 230) !important; color: white; transform: scale(1); }
                        50% { background-color:rgb(241, 126, 11) !important; color: black; transform: scale(1.05); }
                        100% { background-color:rgb(204, 17, 17) !important; color: white; transform: scale(1); }
                    }
                    
                    .blinking td {
                        animation: blink 1.5s infinite alternate;
                    }
                </style>
            </thead>
            <tbody>
                {% for ticket in tickets %}
                <tr {% if ticket.status == 'open' %} class="blinking" {% endif %}>
                    <td>{{ ticket.created_at|date:"Y-m-d H:i" }}</td>
                    <td>{{ ticket.created_by }}</td>
                    <td>{{ ticket.workplace }}</td>
                    <td>{{ ticket.description }}</td>
                    <td>
                        {% if ticket.category == "technician" %}
                            <span class="badge bg-danger">🔧 Technik</span>
                        {% elif ticket.category == "quality" %}
                            <span class="badge bg-info">🏅 Jakość</span>
                        {% else %}
                            <span class="badge bg-primary">🛠️ Inżynier</span>
                        {% endif %}
                    </td>
                    <td>{{ ticket.get_status_display }}</td>
                    <td>
                        {% if ticket.status == 'open' %}
                            <a href="{% url 'take_ticket' ticket.id %}" class="btn btn-secondary btn-sm">🟡 Podejmij</a>
                        {% elif ticket.status == 'in_progress' %}
                            <a href="{% url 'close_ticket' ticket.id %}" class="btn btn-success btn-sm">🟢 Zamknięto</a>
                        {% endif %}
                    </td>
                    <tr {% if ticket.status == 'open' %} class="blinking" data-debug="blinking-active" {% endif %}>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="text-muted">Brak zgłoszeń.</p>
    {% endif %}
</div>

<!-- 🔄 Auto-refresh co 5 sekund -->
<script>
    setInterval(function() {
        location.reload();
    }, 10000); // Odświeżanie co 5 sekund
</script>

{% endblock %}