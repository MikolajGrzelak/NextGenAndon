{% extends "base.html" %}
{% block content %}

<div class="container mt-4">
    <h2>üìã Lista wniosk√≥w o przeliczenie stan√≥w magazynowych</h2>

    <!-- Przycisk do strony z formularzem tworzenia nowego zg≈Çoszenia -->
    <a href="{% url 'cycle_count_requests' %}" class="btn btn-success mb-3">
        üìå Dodaj nowe zg≈Çoszenie
    </a>

    <style>
        table td, table th {
            white-space: nowrap;      /* Nie zawijaj wierszy */
            vertical-align: middle;   /* W pionie wy≈õrodkuj */
        }
        .btn-group { 
            display: inline-flex;     /* Grupa przycisk√≥w w linii */
        }
        .btn-group a.btn {
            margin-right: 5px;        /* Odstƒôp miƒôdzy przyciskami */
        }
    </style>
    
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Item</th>
                <th>Lokalizacja</th>
                <th>Ilo≈õƒá w systemie</th>
                <th>Ilo≈õƒá fizycznie</th>
                <th>R√≥≈ºnica</th>
                <th>Komentarz</th>
                <th>Status</th>
                <th>Akcje</th>
            </tr>
        </thead>
        <tbody>
            {% for req in requests %}
            <tr>
                <td>{{ req.item }}</td>
                <td>{{ req.location }}</td>
                <td>{{ req.system_qty }}</td>
                <td>{{ req.physical_qty }}</td>
                <td>{{ req.difference }}</td>
                <td>{{ req.comment }}</td>
                <td><strong>{{ req.get_status_display }}</strong></td>
                <td>
                    {% if req.status == "new" %}
                        <!-- Zmieniamy z 'open' na 'review' -->
                        <a href="{% url 'update_cycle_count_status' req.id 'review' %}"
                           class="btn btn-warning btn-sm">üîÑ W trakcie</a>

                    {% elif req.status == "review" %}
                        <!-- Dopiero w tym statusie widaƒá kolejne przyciski -->
                        <a href="{% url 'update_cycle_count_status' req.id 'closed' %}"
                           class="btn btn-primary btn-sm">‚úÖ Znalezione</a>
                        <a href="{% url 'update_cycle_count_status' req.id 'removed' %}"
                           class="btn btn-danger btn-sm">‚ùå Do usuniƒôcia</a>

                    {% else %}
                        <!-- Je≈õli status inny ni≈º open/review, np. closed/removed,
                             nic nie wy≈õwietlamy albo pokazujemy np. 'Zamkniƒôty' -->
                        <span class="text-muted">Brak akcji</span>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="8" class="text-center">Brak zg≈Çosze≈Ñ</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}
